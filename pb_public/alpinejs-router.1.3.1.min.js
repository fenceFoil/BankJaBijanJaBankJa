(()=>{var f=class{#t;constructor(r,e={}){this.#t=new URL(r),this.mode=e.mode??"web",this.base=e.base??""}set url(r){this.#t=new URL(r)}get url(){return this.#t.href}get path(){return this.mode==="hash"&&this.#t.hash?this.#t.hash.slice(1).split("?").shift():this.#t.pathname.replace(this.base,"")}get query(){return Object.fromEntries(new URLSearchParams(this.#t.href.indexOf("?")>-1?this.#t.href.split("?").pop():""))}resolve(r,e,s=!1){let n=this.#t.origin+this.base+(this.mode==="hash"?"#":"")+r,i=s?new URLSearchParams(e).toString():new URLSearchParams({...this.query,...e}).toString();return this.url=n+(i?"?"+i:""),this}static resolveTemplatePath(r,e){if(!e||e.startsWith("/"))return e;let s=r.slice(0,r.lastIndexOf("/"));if(e.startsWith("./"))return s+e.slice(1);if(e.startsWith("../")){let n=/\.\.\//g,i=e.match(n).length,u=s.split("/");for(;i--;)u.pop();return u.length===0&&(u=[""]),[...u,e.replace(n,"")].join("/")}return e}};var h=class{static build(r){if(r.indexOf(":")===-1)return r;let e=r.split("/").map(s=>{if(!s.startsWith(":"))return s;let n=s.substr(1),i="[^/]+",u=n.match(/\((.+?)\)/);return u&&(n=n.substr(0,n.indexOf("(")),i=u[1]),`(?<${n}>${i})`}).join("/");return new RegExp(`^${e}$`)}static match(r,e){if(e instanceof RegExp){let s=r.match(e);return s?{...s.groups}:!1}return r===e}static is(r,e){return e instanceof RegExp?e.test(r):r===e}};var _=class{#t={};#e={};add(r){this.#t={...this.#t,[r]:this.#e[r]??h.build(r)}}match(r){console.assert(r instanceof f);let e=r.path;for(let[s,n]of Object.entries(this.#t)){let i=h.match(e,n);if(i)return i===!0?{}:i}return!1}is(r,...e){console.assert(r instanceof f);let s=r.path;for(let n of e){let i=this.#t[n]??this.#e[n]??h.build(n);if(this.#e[n]=i,h.is(s,i))return!0}return!1}not(r,...e){console.assert(r instanceof f);let s=r.path;for(let n of e){let i=this.#t[n]??this.#e[n]??h.build(n);if(this.#e[n]=i,h.is(s,i))return!1}return!0}notfound(r){console.assert(r instanceof f);let e=r.path;return Object.values(this.#t).findIndex(s=>h.is(e,s))===-1}};function I(a){let r=new _,e=a.reactive({mode:"web",base:"",href:location.href,path:"",query:{},params:{},loading:!1}),s={get path(){return e.path},get query(){return e.query},get params(){return e.params||{}},get loading(){return e.loading},config(t={}){t.mode!=="hash"&&t.base&&t.base.endsWith("/")&&(t.base=t.base.slice(0,-1)),e.mode=t.mode??"web",e.base=t.base??""},push(...t){return u(...t)},replace(...t){return T(...t)},resolve(t={}){return n(e.href).resolve(e.path,t).url},is(...t){return r.is(n(e.href),...t)},not(...t){return r.not(n(e.href),...t)},get notfound(){return r.notfound(n(e.href))}};a.$router=s,a.magic("router",()=>s);function n(t){return new f(t,{mode:e.mode,base:e.base})}function i(){let t=n(e.href);e.path=t.path,e.query=t.query,e.params=r.match(t)}a.effect(()=>i()),a.nextTick(()=>{e.mode==="web"&&!e.base&&i()}),window.addEventListener("popstate",()=>e.href=location.href);function u(t,p={}){t.startsWith(location.origin)||(e.mode==="hash"?t=location.origin+(e.base||"/")+"#"+t:t=location.origin+e.base+t),location.href!==t&&(history[p.replace?"replaceState":"pushState"]({},"",t),e.href=t)}function T(t){u(t,{replace:!0})}let w={},b={},L=new Set;a.directive("route",(t,{modifiers:p,expression:d},{effect:E,cleanup:y})=>{p.includes("notfound")||r.add(d);let v=o=>(b[o]?b[o].then(c=>t.innerHTML=c):b[o]=fetch(o).then(c=>c.text()).then(c=>(w[o]=c,t.innerHTML=c,c)),b[o]),l=f.resolveTemplatePath(location.pathname,t.getAttribute("template")??t.getAttribute("template.preload")),g;t.hasAttribute("template.preload")&&(g=v(l).finally(()=>g=!1));function m(){if(t._x_currentIfEl)return t._x_currentIfEl;let o=()=>{if(L.has(d))return;L.add(d);let c=t.content.cloneNode(!0).firstElementChild;a.addScopeToNode(c,{},t),a.mutateDom(()=>{t.after(c),a.initTree(c)}),t._x_currentIfEl=c,t._x_undoIf=()=>{c.remove(),delete t._x_currentIfEl},a.nextTick(()=>L.delete(d))};t.content.firstElementChild?o():l?w[l]?(t.innerHTML=w[l],o()):g?g.then(()=>o()):(e.loading=!0,v(l).then(()=>o()).finally(()=>e.loading=!1)):console.error(`Template for '${d}' is missing`)}function x(){t._x_undoIf&&(t._x_undoIf(),delete t._x_undoIf)}a.nextTick(()=>{E(()=>{let o=n(e.href);(p.includes("notfound")?r.notfound(o):r.is(o,d))?m():x()})}),y(()=>t._x_undoIf&&t._x_undoIf())}),a.directive("link",(t,{modifiers:p,expression:d},{evaluate:E,effect:y,cleanup:v})=>{let l=n(t.href);t.href=l.resolve(l.path,l.query,!0).url;function g(m){m.preventDefault(),u(t.href,{replace:p.includes("replace")})}if(t.addEventListener("click",g),p.includes("activity")){let m=d?E(d):{};m.active??="active",m.exactActive??="exact-active",y(()=>{let[x,o]=[n(t.href),n(e.href)];t.classList.toggle(m.active,o.path.startsWith(x.path)),t.classList.toggle(m.exactActive,x.path===o.path)})}v(()=>{t.removeEventListener("click",g)})})}document.addEventListener("alpine:init",()=>{window.Alpine.plugin(I)});})();
